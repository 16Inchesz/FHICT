[plantuml, state-diagram, svg]
----
@startuml
[*] --> HappyState
HappyState : GetVerification();
HappyState --> Confirmation

state Confirmation{
    Confirmation --> WaitForAck : MessageTimerReset() 
    WaitForAck --> ValidatingAck : !MessageTimerElapsed(3s) &&\n MessageAvailable()/ \n message = ReadMessage()
    WaitForAck --> TimeoutAck : MessageTimerElapsed(3s)

    ValidatingAck --> AckValidated : isMessageValid(message)/\n message = TrimMessage()
    ValidatingAck --> CorruptedAck : !isMessageValid(message)

    AckValidated --> NextState : message == "ACK" \n counter = 0
    AckValidated --> AckFailed : MESSAGE == "NACK"
    AckValidated --> AckUnknown : message != "ACK" && message != "NACK"

    AckFailed --> WaitForAck : counter++ \nSendMessage(command)
    AckUnknown --> WaitForAck : counter++ \nSendMessage(command)
    CorruptedAck --> WaitForAck : counter++ \nSendMessage(command)
    TimeoutAck --> WaitForAck : counter++ \nSendMessage(command)

    WaitForAck --> OrangeBlinking : counter ==SendMessage(command) 3
    OrangeBlinking --> WaitForAck : counter = 0 \n ResetButtonPushed()
}



@enduml
----